# Spec: 实现简单定投回测

> 所有命令在沙箱外运行。

## 上下文

在 `q1-strategy.ipynb` 中已有上一步的代码：使用 yfinance 获取了沪深300ETF（510300.SS）的日线数据，存储在变量 `df` 中，索引为 DatetimeIndex，包含 Close 列。

## 任务

基于已有数据，实现最简单的定投策略回测：每月第一个交易日，用固定金额买入。

## 要求

1. 在 notebook 中新建代码单元格，基于已有的 `df` 变量
2. 策略规则：每月第一个交易日，用 1000 元按收盘价买入
3. 将回测逻辑封装为函数 `backtest_dca(df, monthly_amount=1000)`，返回 DataFrame（后续步骤会复用此函数）
4. 实现回测逻辑：
   - 按月分组，取每月第一个交易日作为买入日
   - 每月买入份额 = 1000 / 当日收盘价
   - 累计持有份额 = 逐月累加
   - 累计投入成本 = 月数 × 1000
   - 每月末持仓市值 = 累计份额 × 当月最后一个交易日收盘价
   - 累计收益率 = (持仓市值 - 累计成本) / 累计成本
5. 调用函数得到结果：`result_dca = backtest_dca(df)`，包含列：total_cost, total_shares, portfolio_value, return

## 结果呈现

1. 打印：投资期间、投资月数、总投入金额、最终市值、最终收益率
2. 画两张图（上下排列，figsize 12×8）：
   - 图1「持仓市值 vs 累计成本」：两条线 + 盈利区域填充绿色、亏损区域填充红色
   - 图2「累计收益率」：收益率曲线，零线上方填充绿色、下方填充红色
