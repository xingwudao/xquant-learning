# Spec: 加入均线择时条件

> 所有命令在沙箱外运行。

## 上下文

在 `q1-strategy.ipynb` 中已有：
- 沪深300ETF 日线数据（变量 `df`，含 Close 列）
- 简单定投回测函数 `backtest_dca` 和结果（`result_dca`）
- 基准对比代码

## 任务

在定投策略基础上加入均线择时条件，尝试获取超越市场的收益（Alpha）。

## 要求

1. 在 notebook 中新建代码单元格
2. 新策略规则：每月第一个交易日，**仅当收盘价 > N日均线时**买入 1000 元，否则跳过该月
3. 实现函数 `backtest_dca_with_ma(df, monthly_amount=1000, ma_period=20)`，返回格式与 `result_dca` 一致，额外包含 signal 列（布尔值，是否满足买入条件）。后续步骤会复用此函数
4. 注意处理：
   - 均线计算初期（前 N 天）没有均线值，这些月份不买入
   - 跳过买入的月份，累计成本和份额保持不变
   - 计算收益率时，累计成本为 0 的月份（尚未发生任何买入）收益率直接设为 0，不要用除法，避免除零警告
5. 分别用 MA10、MA20、MA60 三个参数运行回测

## 结果呈现

1. 打印每个参数的结果，格式：`MA10: 收益率 X.XX%, 买入 N/M 次`
2. 打印简单定投收益率作为对照
3. 画一张对比图（figsize 12×6）：
   - 简单定投收益率曲线（灰色虚线）
   - MA10、MA20、MA60 三条收益率曲线（不同颜色实线）
   - 图例 + 网格 + 零线
